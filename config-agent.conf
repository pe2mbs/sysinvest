#
#   Helper for 'cron' attribute
#   https://cron.help/
#
collector:
    url:                        http://scuzzy.pe2mbs.nl:5001/api/agent

objects:
-   name:                       I am alive
    module:                     iamalive
    enabled:                    true
    # Every 24 hours at 00:00
    cron:                       '*/1 * * * *'

-   name:                       Check SSHD service
    module:                     checkpid
    enabled:                    true
    # Every 24 hours at 00:00
    cron:                       '*/1 * * * *'
    filename:                   /run/sshd.pid
    executable:                 'sshd:'
    commandline:                /usr/sbin/sshd -D [listener] 0 of 10-100 startups

-   name:                       Check hp-systray
    module:                     checkprocess
    enabled:                    true
    cron:                       '*/1 * * * *'
    executable:                 /usr/bin/python3
    commandline:
    -   /usr/bin/hp-systray
    -   -x

-   name:                       Check server loads
    module:                     serverloads
    enabled:                    true
    # Every minute, this is just for starting it as the Plugin will run always from point ists started
    # This deals with monitoring the system.
    # When it failes it shall be restarted again.
    cron:                       '*/1 * * * *'

-   name:                       Ethernet adaptor 1
    module:                     network
    enabled:                    true
    cron:                       '*/1 * * * *'
    interfaces:
    -   interface:              enp3s0
        address:                192.168.110.2
        hostname:               matrix.pe2mbs.nl
        media:                  100Mib
    -   interface:              docker0
        address:                172.17.0.1
        hostname:               matrix
        media:                  100Mib
    -   interface:              lo
        address:                127.0.0.1
        hostname:               localhost
        media:                  100Mib
-   name:                       Check filename
    module:                     fileexists
    enabled:                    false
    cron:                       '*/15 * * * *'
    filename:                   /run/sm-notify.pid
    minimal_size:               5
    maximal_size:               5
    mode:                       -rw-rw-----
    expire:                     24:00:00

-   name:                       Check host OSCAM status
    module:                     http
    enabled:                    true
    cron:                       '*/10 * * * *'
    url:                        http://oscam.scuzzy.pe2mbs.nl/status.html
    status_code:                200
    content:                    false
    response:
        content:                null
        headers:
            Server:             nginx/1.18.0
            Content-Type:       text/html
            Transfer-Encoding:  chunked
            Connection:         keep-alive
            Cache-Control:      no-store, no-cache, must-revalidate
            Content-Encoding:   gzip
    inspect:
    -   label:                  Canal Digitaal Card
        xpath:                  //*[@id="id_0x19707c8"]/td[12]
        expected:               CARDOK
    -   label:                  Canal Digitaal Entiltement
        xpath:                  //*[@id="id_0x19707c8"]/td[12]/a
        # expected:              (1 entitlement)

-   name:                       Check REDIS host
    module:                     redis
    enabled:                    true
    cron:                       '*/1 * * * *'
    token:                      Hello world this is sysInvest
    url:                        redis://mbertens:123456ABCDEF@localhost:6379/1
    cert:                       null
    key:                        null
-   name:                       Check FILE-SYSTEM
    module:                     filesystem
    enabled:                    true
    cron:                       '*/5 * * * *'
    partitions:
    -   device:                 /dev/sde
        mountpoint:             /home
        fstype:                 ext4
        free_space:             80%
    -   device:                 /dev/sdf1
        mountpoint:             /
        fstype:                 ext4
        free_space:             94%

-   name:                       Check MYSQL database
    module:                     sql
    enabled:                    true
    cron:                       '*/60 * * * *'
    url:                        mysql://root:5701mb@daecon:3306/mysql
    query:                      'select count(*) from mysql.user'
    type:                       count
    expected:                   2

-   name:                       Check MYSQL database
    module:                     sql
    enabled:                    true
    cron:                       '*/60 * * * *'
    url:                        mysql://root:5701mb@daecon:3306/mysql
    query:                      select host, user from mysql.user
    type:                       rows
    expected:
    -   host:                   '%'
        user:                   root
    -   host:                   '%'
        user:                   spotweb

-   name:                       Check MYSQL database
    module:                     sql
    enabled:                    true
    cron:                       '*/1 * * * *'
    url:                        mysql://root:5701mb@daecon:3306/mysql
    query: >
        SELECT password FROM mysql.user
        WHERE host = '%'
        AND user = 'spotweb'
    type:                       scalar
    expected:                   "*CB1A780861D4718BF5E505C7E7D0340432B926AC"

-   name:                       Check ORACLE database
    module:                     sql
    enabled:                    false
    cron:                       '*/1 * * * *'
    url:                        oracle://root:5701mb@localhost:3306/INFO
    query:                      'select count(*) from users'
    type:                       true
    expected:                   1

-   name:                       Check SQLite3 database
    module:                     sql
    enabled:                    true
    cron:                       '*/1 * * * *'
    url:                        sqlite:///home/mbertens/src/python/sysinvest/test.db
    query:                      'select count(*) from test'
    type:                       count
    expected:                   1

-   name:                       Check SQLite3 database
    module:                     sql
    enabled:                    true
    cron:                       '*/1 * * * *'
    url:                        sqlite:///home/mbertens/src/python/sysinvest/test.db
    query:                      select Field1, Field2 from test
    type:                       rows
    expected:
    -   [ 1, "Hello world" ]

-   name:                       Check environment
    module:                     environment
    enabled:                    true
    cron:                       '*/60 * * * *'
    variables:
        LANGUAGE:               nl_NL
        USER:                   mbertens
        PAPERSIZE:              A4

-   name:                       System sensors
    module:                     lmsensors
    enabled:                    true
    cron:                       '*/1 * * * *'

logging:
    version: 1
    formatters:
        short:
            format: '%(message)s'
        brief:
            format: '%(asctime)s %(levelname)-8s "%(name)-25s" %(message)s'
            datefmt: '%Y-%m-%d %H:%M:%S'
        precise:
            format: '%(asctime)s %(levelname)-8s %(name)-15s %(message)s'
            datefmt: '%Y-%m-%d %H:%M:%S'
    handlers:
        console:
            class : logging.StreamHandler
            formatter: brief
            level   : DEBUG
            stream  : ext://sys.stdout
        file:
            class : logging.handlers.RotatingFileHandler
            formatter: precise
            filename: logconfig.log
            maxBytes: 10240000
            level   : DEBUG
            backupCount: 3
        syslog:
            class: logging.handlers.SysLogHandler
            address: [ 'localhost', 514 ]
            formatter: precise
            facility: user
            # SOCK_DGRAM = 2
            # SOCK_STREAM = 1
            socktype: 1
    loggers:
        monitor:
            level: DEBUG
#            propagate: false
#            handlers:
#            -   console
#            -   file
        collector:
            level: INFO
#            propagate: false
#            handlers:
#            -   console
#            -   file
        plugin:
            level: DEBUG
#             propagate: false
#             handlers:
#             -   console
#             -   file
        agent:
            level: DEBUG
#             propagate: false
#             handlers:
#             -   console
#             -   file

    root:
        level: DEBUG
        handlers:
            -   console
            -   file
